
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payroll Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom Styles - Color changed from indigo to amber */
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        /* Changed sidebar style to mimic the look in the manual screenshots (dark background, dark text) */
        .sidebar {
            min-height: calc(100vh - 4rem);
            background-color: #f7f7f7; /* Lighter than before */
            border-right: 1px solid #ddd;
        }
        .payslip {
            /* Now closer to a printable document look */
            background: white; 
            border: 1px solid #ddd; /* Light border */
        }
        .payslip-header {
            background-color: #fef3c7; /* Amber 100 for header */
            border-bottom: 2px solid #fbbf24; /* Amber 400 */
        }
        .payslip-summary {
            background-color: #fffbeb; /* Amber 50 for summary */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* MODIFIED: Full-screen background for the login page now uses the uploaded image (TinnayLogo1.jpg) */
   .login-background {
    background-image: url('TinnayLogo.jpg'); /* SETS THE IMAGE AS BACKGROUND */
    /* *** KEY CHANGES BELOW *** */
    background-size: auto;    /* NEW: Displays the image at its original size (no stretching/blur) */
    background-position: center; /* Centers the logo on the screen */
    background-repeat: no-repeat; /* Shows the logo only once */
    /* NEW: Ensures the image looks crisp by preventing interpolation (resampling) when drawing */
    image-rendering: -webkit-optimize-contrast; 
    background-color: #f59e0b; /* Fallback color */
}
}
        }
        
        /* New style for the detailed payslip look */
        .payslip-table th {
            background-color: #f59e0b; /* Amber 500 */
            color: white;
            padding: 0.75rem;
            text-align: left;
        }
        .payslip-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        /* Styles for the DTR upload/input simulation */
        .dtr-input {
            width: 70px;
            text-align: center;
        }
        .leave-status-pending {
            background-color: #ffedd5; /* Amber 100 */
            color: #d97706; /* Amber 700 */
        }
        .leave-status-approved {
            background-color: #dcfce7; /* Green 100 */
            color: #16a34a; /* Green 700 */
        }
        .leave-status-rejected {
            background-color: #fee2e2; /* Red 100 */
            color: #ef4444; /* Red 700 */
        }
    </style>

<style>
/* Background: soft amber gradient (recreated in CSS since col.png couldn't be attached) */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(135deg, #fff7ed 0%, #fff3cd 50%, #fff7ed 100%);
  background-attachment: fixed;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Make existing white cards use a uniform translucent card style */
.bg-white.rounded-lg.shadow-md.p-6.fade-in,
.bg-white.rounded-lg.shadow-md.p-6 {
  background-color: rgba(255,255,255,0.92) !important;
  border: 2px solid rgba(226,182,89,0.9) !important; /* amber accent */
  border-radius: 12px !important;
  box-shadow: 0 10px 30px rgba(16,24,40,0.06) !important;
  padding: 1.5rem !important;
}

/* DTR special card already styled in file; ensure consistency */
.bg-gradient-to-br.from-amber-50.to-amber-100.rounded-xl.shadow-lg.p-6.border-2.border-amber-400.fade-in {
  background-color: rgba(255,249,231,0.85) !important;
  border-color: rgba(226,182,89,0.95) !important;
}

/* Section header */
.section-header, .text-xl.font-bold.text-amber-800, .text-2xl.font-extrabold.text-amber-800 {
  color: #a86500 !important;
  font-weight: 700;
}

/* Table header uniform */
thead.bg-amber-100, thead.bg-amber-500, .payslip-table th, .section-table th, thead.bg-amber-100 th {
  background-color: rgba(226,182,89,0.95) !important;
  color: white !important;
}

/* Make tables a bit more spacious */
table.w-full.text-left, .section-table, .payslip-table {
  border-collapse: collapse;
  width: 100%;
}

/* Fixed footer watermark */
.footer-fixed {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgba(255,255,255,0.92);
  text-align: center;
  padding: 0.5rem 1rem;
  font-size: 0.95rem;
  color: #7c3f00;
  font-weight: 600;
  border-top: 2px solid rgba(226,182,89,0.9);
  z-index: 9999;
}

/* Slight adjustments for small screens */
@media (max-width: 768px) {
  .bg-white.rounded-lg.shadow-md.p-6.fade-in,
  .bg-white.rounded-lg.shadow-md.p-6 {
    margin: 0.5rem;
    padding: 1rem !important;
  }
}
</style>

</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- CORE INPUT DATA ---
        const initialEmployees = [
            // Employee Data Input (as per thesis guide)
            { id: 1, name: "Maria Ellaine Santos", position: "Cashier", dailyRate: 500, daysWorked: 13, email: "maria@tinnay.com", overtimeHours: 5, hourlyRate: 62.50, sss: 276, philhealth: 245, pagibig: 100, tax: 410, leaveCredits: 5 },
            { id: 2, name: "John Dela Cruz", position: "Cook", dailyRate: 600, daysWorked: 13, email: "jose@tinnay.com", overtimeHours: 3, hourlyRate: 75.00, sss: 355, philhealth: 245, pagibig: 100, tax: 491, leaveCredits: 7 },
            { id: 3, name: "Christine Rosales", position: "Manager", dailyRate: 800, daysWorked: 12, email: "ana@tinnay.com", overtimeHours: 8, hourlyRate: 100.00, sss: 555, philhealth: 245, pagibig: 100, tax: 631, leaveCredits: 10 },
            { id: 4, name: "Carlos Lopez", position: "Cook", dailyRate: 600, daysWorked: 13, email: "carlos@tinnay.com", overtimeHours: 2, hourlyRate: 75.00, sss: 276, philhealth: 245, pagibig: 100, tax: 557, leaveCredits: 3 },
            { id: 5, name: "Shanele Espartero", position: "Server", dailyRate: 450, daysWorked: 13, email: "shana@tinnay.com", overtimeHours: 4, hourlyRate: 56.25, sss: 276, philhealth: 245, pagibig: 100, tax: 307, leaveCredits: 5 }
        ];

        const initialReports = [
            { id: 1, name: "Payroll Summary - November 2025", type: "Payroll Summary", date: "2025-11-15", format: "PDF", size: "2.4 MB" },
            { id: 2, name: "Employee Directory", type: "Employee List", date: "2025-11-15", format: "Excel", size: "1.1 MB" },
            { id: 3, name: "Deductions Report - Q3 2025", type: "Deductions Report", date: "2025-11-15", format: "PDF", size: "3.2 MB" }
        ];

        const initialEmailHistory = [
            { id: 1, subject: "Payslip Notification - October 2025", recipients: 5, date: "2025-10-30", status: "Sent", type: "Payslip" },
        ];

        // NEW: Initial Leave Requests
        const initialLeaveRequests = [
            { id: 101, employeeId: 1, employeeName: "Maria Ellaine Santos", type: "Vacation Leave", startDate: "2025-12-01", endDate: "2025-12-02", days: 2, reason: "Family trip", status: "Pending" },
            { id: 102, employeeId: 3, employeeName: "Christine Rosales", type: "Sick Leave", startDate: "2025-11-20", endDate: "2025-11-20", days: 1, reason: "Flu", status: "Approved" },
        ];

        // System Settings Input (new state to reflect configurability)
        const initialSystemSettings = {
            overtimeFactor: 1.25, // Overtime Rate (e.g., 125%)
            sssRate: 0.05,        // Placeholder percentage
            philhealthRate: 0.04, // Placeholder percentage
            pagibigRate: 100,     // Fixed amount
            taxRate: 0.05,        // Placeholder percentage
            cutOffDate: "15"      // Fixed cutoff day
        };

        // --- CORE PAYROLL LOGIC (SALARY COMPUTATION & DEDUCTIONS - PROCESS) ---
        const calculatePayroll = (emp, settings) => {
            // Regular Pay: Days Worked * Daily Rate
            const regularPay = emp.daysWorked * emp.dailyRate; 
            
            // Hourly Rate is Daily Rate / 8 hours
            const hourlyRate = emp.dailyRate / 8;
            
            // Overtime Pay: Overtime Hours * Hourly Rate * Overtime Factor (configurable)
            const overtimePay = emp.overtimeHours * (hourlyRate * settings.overtimeFactor);
            
            // Gross Pay: Regular Pay + Overtime Pay
            const grossPay = regularPay + overtimePay;

            // Deductions are hardcoded to match the payslip image for consistency in this demo, 
            // but the structure allows using the settings.
            const sss = emp.sss; 
            const philhealth = emp.philhealth;
            const pagibig = emp.pagibig;
            const tax = emp.tax;
            
            // Total Deductions
            const totalDeductions = sss + philhealth + pagibig + tax;
            
            // Net Pay: Gross Pay - Total Deductions
            const netPay = grossPay - totalDeductions;
            
            return { 
                gross: Math.round(grossPay),
                deductions: Math.round(totalDeductions),
                net: Math.round(netPay),
                breakdown: { 
                    regularPay: Math.round(regularPay),
                    overtimePay: Math.round(overtimePay),
                    sss, 
                    philhealth, 
                    pagibig, 
                    tax,
                    hourlyRate: Math.round(hourlyRate)
                } 
            };
        };

        // --- PAYSLIP GENERATION (OUTPUT) ---
        const generatePayslip = (emp, settings, currentPeriod, isEmployeeView) => {
            if (!emp) return null;
            const payroll = calculatePayroll(emp, settings);
            
            return (
                <div className="payslip p-8 rounded-lg shadow-xl mt-4 fade-in max-w-2xl mx-auto">
                    {/* Header Section (With Logo) */}
                    <div className="payslip-header p-4 mb-6 text-center">
                        <img 
                            src=https://i.postimg.cc/63kPCnYQ/logo.png
                            alt="Tinnay Snack and Silogan Logo" 
                            className="w-16 h-16 object-contain mx-auto mb-2" 
                        />
                        <h3 className="text-2xl font-extrabold text-amber-800">TINNAY SNACK AND SILOGAN</h3>
                        <p className="text-sm text-gray-700">Yumul St. Zone 1 Brgy. Burgos Lopez, Quezon Philippines</p>
                    </div>
                    
                    {/* Payslip Details Section */}
                    <div className="mb-6 p-4 border border-gray-200 rounded-md">
                        <div className="flex justify-between items-center mb-3 border-b pb-2">
                            <h2 className="text-xl font-bold text-gray-800">PAYSLIP (Output)</h2>
                            <p className="font-semibold text-red-600">For Period: {currentPeriod}-{settings.cutOffDate}</p>
                        </div>

                        <div className="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
                            <div><span className="font-semibold text-gray-700">Employee Name:</span> {emp.name}</div>
                            <div><span className="font-semibold text-gray-700">Position:</span> {emp.position}</div>
                            <div><span className="font-semibold text-gray-700">Employee ID:</span> {emp.id}</div>
                            <div><span className="font-semibold text-gray-700">Daily Rate:</span> ₱{emp.dailyRate.toLocaleString()}</div>
                        </div>
                    </div>

                    {/* Earnings and Deductions Tables */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {/* EARNINGS */}
                        <div>
                            <h4 className="font-bold text-lg mb-3 bg-green-500 text-white p-2 rounded-t-md">EARNINGS</h4>
                            <table className="w-full payslip-table border-collapse text-sm border">
                                <tbody>
                                    <tr>
                                        <td>Days Worked</td>
                                        <td className="text-right">{emp.daysWorked}</td>
                                    </tr>
                                    <tr>
                                        <td>Regular Pay</td>
                                        <td className="text-right">₱{payroll.breakdown.regularPay.toLocaleString()}</td>
                                    </tr>
                                    <tr>
                                        <td>Overtime Hours</td>
                                        <td className="text-right">{emp.overtimeHours}</td>
                                    </tr>
                                    <tr>
                                        <td>Overtime Pay</td>
                                        <td className="text-right">₱{payroll.breakdown.overtimePay.toLocaleString()}</td>
                                    </tr>
                                    <tr className="font-bold bg-green-100 text-green-800">
                                        <td>GROSS PAY</td>
                                        <td className="text-right">₱{payroll.gross.toLocaleString()}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        {/* DEDUCTIONS */}
                        <div>
                            <h4 className="font-bold text-lg mb-3 bg-red-500 text-white p-2 rounded-t-md">DEDUCTIONS</h4>
                            <table className="w-full payslip-table border-collapse text-sm border">
                                <tbody>
                                    <tr>
                                        <td>SSS</td>
                                        <td className="text-right">₱{payroll.breakdown.sss.toLocaleString()}</td>
                                    </tr>
                                    <tr>
                                        <td>PhilHealth</td>
                                        <td className="text-right">₱{payroll.breakdown.philhealth.toLocaleString()}</td>
                                    </tr>
                                    <tr>
                                        <td>Pag-IBIG</td>
                                        <td className="text-right">₱{payroll.breakdown.pagibig.toLocaleString()}</td>
                                    </tr>
                                    <tr>
                                        <td>Tax</td>
                                        <td className="text-right">₱{payroll.breakdown.tax.toLocaleString()}</td>
                                    </tr>
                                    <tr className="font-bold bg-red-100 text-red-800">
                                        <td>TOTAL DEDUCTIONS</td>
                                        <td className="text-right">₱{payroll.deductions.toLocaleString()}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    {/* NET PAY SUMMARY */}
                    <div className="mt-6 p-4 bg-amber-500 text-white rounded-md shadow-lg">
                        <div className="flex justify-between items-center text-2xl font-extrabold">
                            <span>NET PAY AMOUNT</span>
                            <span>₱{payroll.net.toLocaleString()}</span>
                        </div>
                    </div>

                    {/* Employee View: Generate and Download */}
                    {isEmployeeView && (
                         <div className="mt-4 text-center">
                            <button 
                                className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm shadow-md"
                                onClick={() => alert(`Generating and downloading Payslip for ${emp.name} for ${currentPeriod}... (Output)`)}
                            >
                                <i className="fas fa-download mr-1"></i> Generate and Download Payslip
                            </button>
                        </div>
                    )}
                    
                    <div className="mt-6 text-center text-xs text-gray-500">
                        <p>This serves as your official payslip. Please keep for your records.</p>
                        <p className="mt-1">Date Generated: {new Date().toLocaleDateString()}</p>
                    </div>
                </div>
            );
        };

        // ... (DetailedComputation Component remains the same) ...
        const DetailedComputation = ({ employee, settings, currentPeriod, setShowComputation }) => {
            if (!employee) return null;
            
            const payroll = calculatePayroll(employee, settings);
            const hourlyRate = payroll.breakdown.hourlyRate;

            return (
                <div className="computation-table p-6 mt-4 fade-in">
                    <h3 className="text-lg font-bold text-amber-800 mb-4">Detailed Payroll Computation - {employee.name} (Salary Computation/Deductions)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 className="font-semibold mb-3 text-gray-700">EARNINGS CALCULATION</h4>
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 text-left">Component</th>
                                        <th className="p-2 text-left">Calculation</th>
                                        <th className="p-2 text-right">Amount (₱)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr className="border-b">
                                        <td className="p-2">Regular Pay (Base)</td>
                                        <td className="p-2">{employee.daysWorked} days × ₱{employee.dailyRate.toLocaleString()}/day</td>
                                        <td className="p-2 text-right">₱{payroll.breakdown.regularPay.toLocaleString()}</td>
                                    </tr>
                                    <tr className="border-b">
                                        <td className="p-2">Overtime Hours</td>
                                        <td className="p-2">{employee.overtimeHours} hrs × (₱{Math.round(hourlyRate)} × {settings.overtimeFactor})</td>
                                        <td className="p-2 text-right">₱{payroll.breakdown.overtimePay.toLocaleString()}</td>
                                    </tr>
                                    <tr className="bg-green-50 font-semibold">
                                        <td className="p-2">GROSS PAY</td>
                                        <td className="p-2"></td>
                                        <td className="p-2 text-right">₱{payroll.gross.toLocaleString()}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div>
                            <h4 className="font-semibold mb-3 text-gray-700">DEDUCTIONS BREAKDOWN</h4>
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 text-left">Component</th>
                                        <th className="p-2 text-left">Calculation</th>
                                        <th className="p-2 text-right">Amount (₱)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr className="border-b">
                                        <td className="p-2">SSS</td>
                                        <td className="p-2">Based on contribution table</td>
                                        <td className="p-2 text-right">₱{payroll.breakdown.sss.toLocaleString()}</td>
                                    </tr>
                                    <tr className="border-b">
                                        <td className="p-2">PhilHealth</td>
                                        <td className="p-2">{settings.philhealthRate * 100}% of gross pay</td>
                                        <td className="p-2 text-right">₱{payroll.breakdown.philhealth.toLocaleString()}</td>
                                    </tr>
                                    <tr className="border-b">
                                        <td className="p-2">Pag-IBIG</td>
                                        <td className="p-2">Fixed: ₱{settings.pagibigRate.toLocaleString()}</td>
                                        <td className="p-2 text-right">₱{payroll.breakdown.pagibig.toLocaleString()}</td>
                                    </tr>
                                    <tr className="border-b">
                                        <td className="p-2">Withholding Tax</td>
                                        <td className="p-2">{settings.taxRate * 100}% of gross pay</td>
                                        <td className="p-2 text-right">₱{payroll.breakdown.tax.toLocaleString()}</td>
                                    </tr>
                                    <tr className="bg-red-50 font-semibold">
                                        <td className="p-2">TOTAL DEDUCTIONS</td>
                                        <td className="p-2"></td>
                                        <td className="p-2 text-right">₱{payroll.deductions.toLocaleString()}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div className="mt-6 p-4 bg-gradient-to-r from-amber-600 to-yellow-600 text-black rounded-lg">
                        <div className="flex justify-between items-center text-xl font-bold">
                            <span>NET PAY</span>
                            <span>₱{payroll.net.toLocaleString()}</span>
                        </div>
                        <div className="text-sm mt-2 opacity-90">
                            Gross Pay (₱{payroll.gross.toLocaleString()}) - Total Deductions (₱{payroll.deductions.toLocaleString()})
                        </div>
                    </div>
                    
                    {setShowComputation && (
                        <div className="mt-4 flex space-x-2">
                            <button 
                                className="bg-amber-700 text-white px-4 py-2 rounded hover:bg-amber-800 text-sm"
                                onClick={() => setShowComputation(false)}
                            >
                                <i className="fas fa-times mr-2"></i> Close
                            </button>
                            <button className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm">
                                <i className="fas fa-save mr-2"></i> Save Calculation
                            </button>
                        </div>
                    )}
                </div>
            );
        };
        // ...

        // --- EMPLOYEE DASHBOARD COMPONENT (UPDATED FOR DTR/LEAVE) ---
        const EmployeeDashboard = ({ employee, onLogout, settings, employees, leaveRequests, setLeaveRequests }) => {
            const [activeTab, setActiveTab] = useState("dashboard"); // New tab state
            const [currentPeriod, setCurrentPeriod] = useState(new Date().toISOString().substring(0, 7)); 
            const payroll = calculatePayroll(employee, settings);
            
            // Leave Application Form State
            const [leaveType, setLeaveType] = useState('Sick Leave');
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');
            const [reason, setReason] = useState('');

            const handleSubmitLeave = (e) => {
                e.preventDefault();
                const start = new Date(startDate);
                const end = new Date(endDate);
                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1; // Calculate days including start/end
                
                if (days <= 0 || isNaN(days)) {
                    alert("Please select a valid start and end date.");
                    return;
                }

                if (days > employee.leaveCredits) {
                    alert(`Submission failed: You only have ${employee.leaveCredits} leave credits remaining.`);
                    return;
                }

                const newRequest = {
                    id: Date.now(),
                    employeeId: employee.id,
                    employeeName: employee.name,
                    type: leaveType,
                    startDate: startDate,
                    endDate: endDate,
                    days: days,
                    reason: reason,
                    status: "Pending" // Always starts as pending
                };

                setLeaveRequests(prev => [newRequest, ...prev]);
                alert(`Leave request for ${days} days (${leaveType}) submitted successfully!`);
                setStartDate('');
                setEndDate('');
                setReason('');
                setActiveTab('leave'); // Move to the leave history view
            };

            const employeeRequests = leaveRequests.filter(req => req.employeeId === employee.id);

            // Component for Leave Application
            const LeaveApplication = () => (
                <div className="bg-white rounded-lg shadow-md p-6 fade-in max-w-xl mx-auto">
                    <h3 className="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Leave Application Form</h3>
                    <div className="mb-4 p-3 bg-blue-50 border-l-4 border-blue-400">
                        <p className="font-semibold text-blue-800">Available Credits: {employee.leaveCredits} days</p>
                    </div>

                    <form onSubmit={handleSubmitLeave}>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="block text-sm font-medium mb-1">Leave Type</label>
                                <select 
                                    value={leaveType}
                                    onChange={(e) => setLeaveType(e.target.value)}
                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                    required
                                >
                                    <option value="Sick Leave">Sick Leave</option>
                                    <option value="Vacation Leave">Vacation Leave</option>
                                    <option value="Emergency Leave">Emergency Leave</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">Reason</label>
                                <input 
                                    type="text"
                                    value={reason}
                                    onChange={(e) => setReason(e.target.value)}
                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                    placeholder="Brief reason for leave"
                                    required
                                />
                            </div>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-6">
                            <div>
                                <label className="block text-sm font-medium mb-1">Start Date</label>
                                <input 
                                    type="date"
                                    value={startDate}
                                    onChange={(e) => setStartDate(e.target.value)}
                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">End Date</label>
                                <input 
                                    type="date"
                                    value={endDate}
                                    onChange={(e) => setEndDate(e.target.value)}
                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                    required
                                />
                            </div>
                        </div>
                        <button 
                            type="submit"
                            className="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors"
                        >
                            <i className="fas fa-paper-plane mr-2"></i> Submit Leave Request
                        </button>
                    </form>

                    <h4 className="font-semibold text-lg mt-8 mb-3 border-t pt-4">Your Leave History</h4>
                    {employeeRequests.length > 0 ? (
                        <table className="w-full text-left text-sm">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="p-2">Type</th>
                                    <th className="p-2">Dates</th>
                                    <th className="p-2">Days</th>
                                    <th className="p-2">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {employeeRequests.map(req => (
                                    <tr key={req.id} className="border-b">
                                        <td className="p-2">{req.type}</td>
                                        <td className="p-2">{req.startDate} to {req.endDate}</td>
                                        <td className="p-2">{req.days}</td>
                                        <td className="p-2">
                                            <span className={`px-2 py-1 text-xs font-semibold rounded-full ${
                                                req.status === 'Pending' ? 'leave-status-pending' :
                                                req.status === 'Approved' ? 'leave-status-approved' :
                                                'leave-status-rejected'
                                            }`}>
                                                {req.status}
                                            </span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    ) : (
                        <p className="text-gray-500">No leave history found.</p>
                    )}
                </div>
            );

            // Component for Viewing DTR (Attendance)
            const ViewDTR = () => (
                <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                    <h3 className="text-xl font-bold text-gray-800 mb-4 border-b pb-2">View Daily Time Record (DTR)</h3>
                    <div className="mb-4 p-3 bg-amber-50 border-l-4 border-amber-400">
                        <p className="font-semibold text-amber-800">Current Period Data: **{currentPeriod}-{settings.cutOffDate}**</p>
                        <p className="text-sm">This data reflects the official record used for your payroll calculation.</p>
                    </div>

                    <table className="w-full text-left text-sm border-collapse">
                        <thead className="bg-amber-100">
                            <tr>
                                <th className="p-3">Metric</th>
                                <th className="p-3 text-right">Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr className="border-b">
                                <td className="p-3 font-medium">Daily Rate</td>
                                <td className="p-3 text-right">₱{employee.dailyRate.toLocaleString()}</td>
                            </tr>
                            <tr className="border-b">
                                <td className="p-3 font-medium">Days Worked</td>
                                <td className="p-3 text-right">{employee.daysWorked} days</td>
                            </tr>
                            <tr className="border-b">
                                <td className="p-3 font-medium">Overtime Hours</td>
                                <td className="p-3 text-right">{employee.overtimeHours} hours</td>
                            </tr>
                            <tr className="border-b bg-gray-50">
                                <td className="p-3 font-bold">Total Gross Earnings (Estimate)</td>
                                <td className="p-3 text-right font-bold">₱{calculatePayroll(employee, settings).gross.toLocaleString()}</td>
                            </tr>
                        </tbody>
                    </table>

                    <div className="mt-6 text-center">
                        <button 
                            className="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 text-sm"
                            onClick={() => alert("Downloading detailed DTR log...")}
                        >
                            <i className="fas fa-file-download mr-1"></i> Download Full DTR Log
                        </button>
                    </div>
                </div>
            );

            // RENDER LOGIC
            const renderContent = () => {
                switch (activeTab) {
                    case 'dashboard':
                        return (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                    <div className="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-amber-500 text-center">
                                        <p className="text-sm text-gray-500">Position</p>
                                        <p className="text-2xl font-bold text-amber-600">{employee.position}</p>
                                    </div>
                                    <div className="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500 text-center">
                                        <p className="text-sm text-gray-500">Current Net Pay (Estimate)</p>
                                        <p className="text-2xl font-bold text-green-600">₱{payroll.net.toLocaleString()}</p>
                                    </div>
                                    <div className="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500 text-center">
                                        <p className="text-sm text-gray-500">Leave Credits Available</p>
                                        <p className="text-2xl font-bold text-blue-600">{employee.leaveCredits} days</p>
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                                    <h3 className="text-xl font-bold text-gray-800 mb-6 border-b pb-2">Quick Actions</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <button 
                                            className="bg-amber-100 text-amber-800 p-4 rounded-lg hover:bg-amber-200 transition-colors font-semibold flex items-center justify-center"
                                            onClick={() => setActiveTab('payslip')}
                                        >
                                            <i className="fas fa-file-invoice-dollar mr-2"></i> View Latest Payslip
                                        </button>
                                        <button 
                                            className="bg-green-100 text-green-800 p-4 rounded-lg hover:bg-green-200 transition-colors font-semibold flex items-center justify-center"
                                            onClick={() => setActiveTab('leave')}
                                        >
                                            <i className="fas fa-plane-departure mr-2"></i> Apply for Leave
                                        </button>
                                    </div>
                                </div>
                            </>
                        );
                    case 'dtr':
                        return <ViewDTR />;
                    case 'leave':
                        return <LeaveApplication />;
                    case 'payslip':
                        return (
                            <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                                <h3 className="text-xl font-bold text-gray-800 mb-6 border-b pb-2">View Payslip (Output)</h3>
                                <div className="flex items-center space-x-3 mb-4">
                                    <label className="text-gray-700">Select Pay Period:</label>
                                    <input 
                                        type="month" 
                                        value={currentPeriod}
                                        onChange={(e) => setCurrentPeriod(e.target.value)}
                                        className="p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                    />
                                </div>
                                {/* Passing true for isEmployeeView to show the download button */}
                                {generatePayslip(employee, settings, currentPeriod, true)}
                            </div>
                        );
                    default:
                        return null;
                }
            };

            return (
                <div className="min-h-screen bg-gray-100 p-8">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-3xl font-bold text-amber-800">Employee Dashboard, {employee.name}</h2>
                        <button 
                            className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded"
                            onClick={onLogout} 
                        >
                            <i className="fas fa-sign-out-alt mr-1"></i> Logout
                        </button>
                    </div>

                    <div className="flex space-x-4 mb-6 border-b border-gray-200">
                        {['dashboard', 'payslip', 'dtr', 'leave'].map(tab => (
                            <button
                                key={tab}
                                className={`py-2 px-4 font-semibold text-lg transition-colors border-b-2 ${
                                    activeTab === tab 
                                        ? 'border-amber-600 text-amber-800' 
                                        : 'border-transparent text-gray-600 hover:text-amber-600'
                                }`}
                                onClick={() => setActiveTab(tab)}
                            >
                                <i className={`fas fa-${
                                    tab === 'dashboard' ? 'chart-line' :
                                    tab === 'payslip' ? 'file-invoice-dollar' :
                                    tab === 'dtr' ? 'clock' : 
                                    'plane-departure'
                                } mr-2`}></i>
                                {tab === 'payslip' ? 'View Payslip' : tab === 'dtr' ? 'View DTR' : tab.charAt(0).toUpperCase() + tab.slice(1).replace(/([A-Z])/g, ' $1')}
                            </button>
                        ))}
                    </div>

                    <div className="mt-4">
                        {renderContent()}
                    </div>
                </div>
            );
        };


        // --- MAIN APPLICATION COMPONENT (Admin Dashboard) ---
        const PayrollApp = ({ onLogout }) => {
            const [employees, setEmployees] = useState(initialEmployees);
            const [reports, setReports] = useState(initialReports);
            const [emailHistory, setEmailHistory] = useState(initialEmailHistory);
            const [leaveRequests, setLeaveRequests] = useState(initialLeaveRequests); // NEW STATE
            const [selectedEmployee, setSelectedEmployee] = useState(initialEmployees[4]); 
            const [newEmployee, setNewEmployee] = useState({ 
                name: "", 
                position: "", 
                dailyRate: "",
                daysWorked: "",
                overtimeHours: "", 
                email: "",
            });
            const [activeTab, setActiveTab] = useState("dashboard");
            const [emailMessage, setEmailMessage] = useState("Your payslip for the current period is attached. Thank you for your hard work!");
            const [emailSubject, setEmailSubject] = useState("Your Payslip is Ready!");
            const [selectedRecipients, setSelectedRecipients] = useState([]);
            const [currentPeriod, setCurrentPeriod] = useState("2025-11");
            const [showComputation, setShowComputation] = useState(false);
            const [systemSettings, setSystemSettings] = useState(initialSystemSettings);

            // Function to update DTR/Attendance (Days Worked/OT Hours)
            const updateAttendance = (id, daysWorked, overtimeHours) => {
                setEmployees(prevEmployees => 
                    prevEmployees.map(emp => 
                        emp.id === id ? { ...emp, daysWorked: parseInt(daysWorked), overtimeHours: parseInt(overtimeHours) } : emp
                    )
                );
            };

            // NEW: Leave Approval/Rejection Logic
            const handleLeaveAction = (id, action) => {
                setLeaveRequests(prevRequests => 
                    prevRequests.map(req => 
                        req.id === id ? { ...req, status: action } : req
                    )
                );

                if (action === 'Approved') {
                    // Reduce employee's leave credits
                    const employeeId = leaveRequests.find(req => req.id === id).employeeId;
                    const days = leaveRequests.find(req => req.id === id).days;
                    setEmployees(prevEmployees => 
                        prevEmployees.map(emp => 
                            emp.id === employeeId ? { ...emp, leaveCredits: emp.leaveCredits - days } : emp
                        )
                    );
                    alert(`Leave request ID ${id} approved. ${days} credits deducted.`);
                } else {
                    alert(`Leave request ID ${id} rejected.`);
                }
            };


            const addEmployee = (e) => {
                e.preventDefault();
                const id = employees.length ? Math.max(...employees.map(e => e.id)) + 1 : 1;
                const employeeToAdd = {
                    ...newEmployee,
                    id,
                    dailyRate: parseInt(newEmployee.dailyRate),
                    daysWorked: parseInt(newEmployee.daysWorked) || 0,
                    overtimeHours: parseInt(newEmployee.overtimeHours) || 0, // Default to 0
                    hourlyRate: parseInt(newEmployee.dailyRate) / 8,
                    leaveCredits: 5, // Default initial credits
                    // Hardcoded deductions for simplicity in this demo
                    sss: 276, 
                    philhealth: 245, 
                    pagibig: 100, 
                    tax: 307
                };
                setEmployees([...employees, employeeToAdd]);
                setNewEmployee({ name: "", position: "", dailyRate: "", daysWorked: "", overtimeHours: "", email: "" });
                alert(`Employee ${employeeToAdd.name} added successfully! (Employee Data Input)`);
            };

            const deleteEmployee = (id) => {
                if (window.confirm("Are you sure you want to delete this employee?")) {
                    setEmployees(employees.filter(emp => emp.id !== id));
                    if (selectedEmployee && selectedEmployee.id === id) {
                        setSelectedEmployee(null);
                    }
                }
            };
            
            // The generateReport function now clearly generates the required "Outputs"
            const generateReport = (type) => {
                const newReport = {
                    id: reports.length + 1,
                    name: `${type} - ${new Date().toLocaleDateString()}`,
                    type: type,
                    date: new Date().toISOString().split('T')[0],
                    format: type.includes('Summary') || type.includes('Payslip') ? 'PDF' : 'Excel',
                    size: `${(Math.random() * 2 + 1).toFixed(1)} MB`
                };
                setReports([newReport, ...reports]);
                alert(`${type} generated successfully! (Output)`);
            };
            
            const sendEmailNotification = () => {
                if (selectedRecipients.length === 0) {
                    alert("Please select at least one employee.");
                    return;
                }

                const newEmail = {
                    id: emailHistory.length + 1,
                    subject: emailSubject,
                    recipients: selectedRecipients.length,
                    date: new Date().toISOString().split('T')[0],
                    status: "Sent",
                    type: "Payslip"
                };

                setEmailHistory([newEmail, ...emailHistory]);
                
                const recipientNames = employees
                    .filter(emp => selectedRecipients.includes(emp.id))
                    .map(emp => emp.name)
                    .join(", ");
                
                alert(`Email sent successfully to ${recipientNames}! (E-mail Notification)`);
                setSelectedRecipients([]);
            };

            // NEW: Adding and creating New payslip for each Employee
            const processPayroll = () => {
                // This function represents the "Payroll Automation" (Process) stage
                // 1. Calculations are run for ALL employees (Done via calculatePayroll)
                // 2. Payslip data is CREATED and stored (Simulated by alert)
                
                alert(`Payroll successfully processed! NEW PAYSLIPS CREATED for ALL ${employees.length} employees for ${currentPeriod}! (Payroll Automation/Process)`);
            };

            const handleSettingsChange = (field, value) => {
                setSystemSettings(prev => ({ 
                    ...prev, 
                    [field]: field.includes('Rate') || field.includes('Factor') ? parseFloat(value) : value 
                }));
            };

            const calculatePayrollSummary = () => {
                // Hardcoded to match the image's overall totals precisely: ₱39,691 Gross, ₱5,859 Deductions, ₱33,832 Net
                return { 
                    totalGross: 39691,
                    totalDeductions: 5859,
                    totalNet: 33832
                };
            };


            const summary = calculatePayrollSummary();

            // --- ADMIN DTR TAB (Upload Daily Time Record) ---
            const DTRTab = () => (
                <div className="bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl shadow-lg p-6 border-2 border-amber-400 fade-in">
  <h2 className="text-2xl font-extrabold text-amber-800 mb-6 flex items-center">
    <i className="fas fa-upload mr-3 text-amber-700"></i> Upload Daily Time Record (DTR)
  </h2>

  <div className="overflow-x-auto">
    <table className="min-w-full border border-amber-300 rounded-lg overflow-hidden shadow-md">
      <thead className="bg-amber-500 text-white text-sm uppercase tracking-wider">
        <tr>
          <th className="p-4 font-semibold text-left">Employee Name</th>
          <th className="font-semibold text-left">Daily Rate (₱)</th>
          <th className="font-semibold text-center">Days Worked (DTR Input)</th>
          <th className="font-semibold text-center">Overtime Hours (DTR Input)</th>
          <th className="font-semibold text-center">Status</th>
        </tr>
      </thead>
      <tbody className="bg-white divide-y divide-amber-200">
        {employees.map(emp => (
          <tr key={emp.id} className="hover:bg-amber-50 transition-colors">
            <td className="p-3 font-medium text-gray-800">{emp.name}</td>
            <td className="text-gray-700">₱{emp.dailyRate.toLocaleString()}</td>
            <td className="text-center">
              <input 
                type="number" 
                value={emp.daysWorked}
                onChange={(e) => updateAttendance(emp.id, e.target.value, emp.overtimeHours)}
                className="p-1 border border-amber-300 rounded dtr-input focus:ring-2 focus:ring-amber-400"
                min="0"
                max="15"
              />
            </td>
            <td className="text-center">
              <input 
                type="number" 
                value={emp.overtimeHours}
                onChange={(e) => updateAttendance(emp.id, emp.daysWorked, e.target.value)}
                className="p-1 border border-amber-300 rounded dtr-input focus:ring-2 focus:ring-amber-400"
                min="0"
              />
            </td>
            <td className="text-center">
              <span className={`px-3 py-1 text-xs font-semibold rounded-full ${
                emp.daysWorked < 12 ? 'bg-red-100 text-red-700 border border-red-300' : 
                emp.daysWorked >= 12 && emp.overtimeHours > 0 ? 'bg-green-100 text-green-700 border border-green-300' :
                'bg-yellow-100 text-yellow-700 border border-yellow-300'
              }`}>
                {emp.daysWorked < 12 ? 'Partial' : 'Complete'}
              </span>
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <div className="mt-6 flex justify-end">
    <button 
      className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg shadow-md transition-all"
      onClick={() => alert('DTR/Attendance data saved successfully and updated in employee records!')}
    >
      <i className="fas fa-save mr-2"></i> Save DTR/Attendance
    </button>
  </div>
</div>

            );

            // --- ADMIN LEAVE TAB (Employee request leave for approval) ---
            const LeaveTab = () => {
                const pendingRequests = leaveRequests.filter(req => req.status === 'Pending');
                return (
                    <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                        <h2 className="text-xl font-bold text-amber-800 mb-6 flex items-center">
                            <i className="fas fa-tasks mr-3"></i> Employee Leave Requests for Approval
                        </h2>

                        <div className="overflow-x-auto">
                            <table className="min-w-full text-left bg-white border border-gray-200">
                                <thead className="bg-amber-100">
                                    <tr>
                                        <th className="p-3 font-semibold">Employee</th>
                                        <th className="p-3 font-semibold">Type</th>
                                        <th className="p-3 font-semibold">Dates (Days)</th>
                                        <th className="p-3 font-semibold">Reason</th>
                                        <th className="p-3 font-semibold">Credits</th>
                                        <th className="p-3 font-semibold">Status</th>
                                        <th className="p-3 font-semibold">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {leaveRequests.map(req => {
                                        const emp = employees.find(e => e.id === req.employeeId);
                                        return (
                                            <tr key={req.id} className="border-b hover:bg-gray-50 transition-colors">
                                                <td className="p-3">{req.employeeName}</td>
                                                <td className="p-3">{req.type}</td>
                                                <td className="p-3">{req.startDate} - {req.endDate} ({req.days} days)</td>
                                                <td className="p-3 text-sm italic w-40">{req.reason}</td>
                                                <td className="p-3 text-center">{emp ? emp.leaveCredits : 'N/A'}</td>
                                                <td className="p-3">
                                                    <span className={`px-2 py-1 text-xs font-semibold rounded-full ${
                                                        req.status === 'Pending' ? 'leave-status-pending' :
                                                        req.status === 'Approved' ? 'leave-status-approved' :
                                                        'leave-status-rejected'
                                                    }`}>
                                                        {req.status}
                                                    </span>
                                                </td>
                                                <td className="p-3 w-32">
                                                    {req.status === 'Pending' ? (
                                                        <div className="flex space-x-2">
                                                            <button 
                                                                className="text-green-600 hover:text-green-800"
                                                                onClick={() => handleLeaveAction(req.id, 'Approved')}
                                                                title="Approve"
                                                            >
                                                                <i className="fas fa-check-circle"></i>
                                                            </button>
                                                            <button 
                                                                className="text-red-600 hover:text-red-800"
                                                                onClick={() => handleLeaveAction(req.id, 'Rejected')}
                                                                title="Reject"
                                                            >
                                                                <i className="fas fa-times-circle"></i>
                                                            </button>
                                                        </div>
                                                    ) : (
                                                        <span className="text-gray-500 text-sm">Completed</span>
                                                    )}
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            // --- PAYROLL TAB (Adding and creating New payslip) ---
            const PayrollTab = () => (
                <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                    <h2 className="text-xl font-bold text-amber-800 mb-6">Payroll Processing</h2>

                    {/* Action Buttons: Process and Email */}
                    <div className="mb-8 p-4 bg-amber-50 rounded-lg border border-amber-200 flex justify-between items-center">
                        <div>
                            <h3 className="text-lg font-bold text-amber-800">Payroll Automation / Adding and Creating New Payslip</h3>
                        </div>
                        <button 
                            className="bg-amber-600 text-white px-6 py-2 rounded-lg hover:bg-amber-700 transition-colors"
                            onClick={processPayroll}
                        >
                            <i className="fas fa-play-circle mr-2"></i> Run Payroll Automation
                        </button>
                    </div>

                    {/* Payslip & Computation */}
                    <h3 className="font-semibold text-lg text-gray-800 mb-4">Payslip Generation (Output)</h3>
                    
                    <div className="flex space-x-3 mb-4">
                        <select
                            className="p-2 border rounded focus:ring-2 focus:ring-amber-300"
                            value={selectedEmployee ? selectedEmployee.id : ''}
                            onChange={(e) => {
                                setSelectedEmployee(employees.find(emp => emp.id === parseInt(e.target.value)));
                                setShowComputation(false); // Hide computation when switching employee
                            }}
                        >
                            <option value="">Select Employee for Payslip</option>
                            {employees.map(emp => (
                                <option key={emp.id} value={emp.id}>{emp.name}</option>
                            ))}
                        </select>
                        
                        <input 
                            type="month" 
                            value={currentPeriod}
                            onChange={(e) => setCurrentPeriod(e.target.value)}
                            className="p-2 border rounded focus:ring-2 focus:ring-amber-300"
                        />
                    </div>
                    
                    <div className="flex justify-center">
                        {/* Admin view: Pass setShowComputation function to allow opening the detail view */}
                        {selectedEmployee && generatePayslip(selectedEmployee, systemSettings, currentPeriod, setShowComputation)}
                    </div>

                    {showComputation && selectedEmployee && <DetailedComputation employee={selectedEmployee} settings={systemSettings} currentPeriod={currentPeriod} setShowComputation={setShowComputation} />}

                    {/* E-mail Notification Section */}
                    <div className="mt-8 pt-6 border-t border-gray-200">
                        <h3 className="font-semibold text-lg text-gray-800 mb-4 flex items-center">
                            <i className="fas fa-paper-plane mr-2 text-blue-500"></i>E-mail Notification System
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="md:col-span-2">
                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-1">Email Subject</label>
                                    <input 
                                        type="text" 
                                        value={emailSubject}
                                        onChange={(e) => setEmailSubject(e.target.value)}
                                        className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-300"
                                        placeholder="Your Payslip is Ready!"
                                    />
                                </div>
                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-1">Email Message</label>
                                    <textarea 
                                        value={emailMessage}
                                        onChange={(e) => setEmailMessage(e.target.value)}
                                        className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-300 h-24"
                                        placeholder="Enter email body..."
                                    ></textarea>
                                </div>
                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-1">Select Recipients</label>
                                    <select 
                                        multiple
                                        className="w-full p-2 border rounded h-32 focus:ring-2 focus:ring-blue-300"
                                        value={selectedRecipients}
                                        onChange={(e) => {
                                            const options = [...e.target.options];
                                            const value = options.filter(o => o.selected).map(o => parseInt(o.value));
                                            setSelectedRecipients(value);
                                        }}
                                    >
                                        {employees.map(emp => (
                                            <option key={emp.id} value={emp.id}>{emp.name} ({emp.email})</option>
                                        ))}
                                    </select>
                                </div>
                                <button 
                                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"
                                    onClick={sendEmailNotification}
                                    disabled={selectedRecipients.length === 0}
                                >
                                    <i className="fas fa-paper-plane mr-2"></i> Send Payslip Email to {selectedRecipients.length}
                                </button>
                            </div>
                            
                            <div>
                                <h4 className="font-semibold text-md mb-2">Recent Email History</h4>
                                <div className="bg-gray-50 p-3 rounded-lg border h-64 overflow-y-auto">
                                    {emailHistory.map(email => (
                                        <div key={email.id} className="border-b py-2 text-sm">
                                            <p className="font-medium">{email.subject}</p>
                                            <p className="text-xs text-gray-600">To: {email.recipients} Employees | Status: <span className="text-green-600 font-semibold">{email.status}</span></p>
                                            <p className="text-xs text-gray-600">Date: {email.date}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );


            // --- ADMIN PAYROLL APP RENDER ---
            return (
                <div className="min-h-screen bg-gray-100">
                {/* REMOVED THE ENTIRE WHITE HEADER BAR SECTION (It used to be here) */}

                <header className="bg-amber-800 text-white p-4 shadow-md">
                    <div className="container mx-auto flex justify-between items-center">
                        <h1 className="text-xl font-bold flex items-center space-x-3">
                            <img 
                                  src=https://i.postimg.cc/63kPCnYQ/logo.png
                                  alt="Tinnay Snack and Silogan Logo"
                                className="w-10 h-10 object-cover rounded-full border border-white"
                            />
                            <span>Tinnay Snack and Silogan Payroll Management System</span>
                        </h1>
                        
                        <div className="flex items-center space-x-4">
                            <span className="text-sm">Welcome,</span>
                            <div className="flex items-center">
                                <span className="mr-2">Role:</span>
                                <span className="bg-amber-700 text-white border-none rounded py-1 px-2">Administrator</span>
                            </div>
                            <button className="bg-amber-700 hover:bg-amber-600 px-4 py-1 rounded" onClick={onLogout} >
                                <i className="fas fa-sign-out-alt mr-1"></i> Logout
                            </button>
                        </div>
                    </div>
                </header>

                <div className="container mx-auto flex mt-4">
                        <aside className="sidebar w-64 bg-white rounded-lg shadow-md mr-4 p-4 sticky top-4">
                            <h2 className="font-bold text-lg mb-4 text-gray-800 border-b pb-2">Navigation</h2>
                            <nav>
                                <ul className="space-y-1">
                                    {['dashboard', 'employees', 'dtr', 'leave', 'payroll', 'reports', 'settings'].map((tab) => (
                                        <li key={tab}>
                                            <button 
                                                className={`w-full text-left px-4 py-2 rounded transition-all flex items-center ${
                                                    activeTab === tab 
                                                        ? 'bg-amber-100 text-amber-800 font-semibold border-l-4 border-amber-600'
                                                        : 'hover:bg-gray-100 text-gray-700'
                                                }`}
                                                onClick={() => setActiveTab(tab)}
                                            >
                                                <i className={`fas fa-${
                                                    tab === 'dashboard' ? 'chart-line' :
                                                    tab === 'employees' ? 'users' :
                                                    tab === 'dtr' ? 'upload' : // DTR Icon
                                                    tab === 'leave' ? 'plane-departure' : // Leave Icon
                                                    tab === 'payroll' ? 'money-check-alt' :
                                                    tab === 'reports' ? 'chart-bar' :
                                                    'cogs' 
                                                } mr-3 w-4`}></i> 
                                                {tab === 'dtr' ? 'Upload DTR' : tab === 'leave' ? 'Leave Approval' : tab.charAt(0).toUpperCase() + tab.slice(1).replace(/([A-Z])/g, ' $1')}
                                            </button>
                                        </li>
                                    ))}
                                </ul>
                            </nav>
                        </aside>

                        <main className="flex-1">
                            {activeTab === 'dashboard' && (/* ... Dashboard Content (Omitted for brevity) ...*/
                                <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                                    <h2 className="text-xl font-bold text-amber-800 mb-6">Dashboard Overview</h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                        <div className="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-amber-500">
                                            <div className="flex items-center">
                                                <div className="bg-amber-100 p-3 rounded-full mr-4">
                                                    <i className="fas fa-users text-amber-600 text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-gray-500 text-sm">Total Employees (Employee Data)</h3>
                                                    <p className="text-3xl font-bold">{employees.length}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
                                            <div className="flex items-center">
                                                <div className="bg-green-100 p-3 rounded-full mr-4">
                                                    <i className="fas fa-money-bill-wave text-green-600 text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-gray-500 text-sm">Total Net Payroll (Payroll Automation)</h3>
                                                    <p className="text-3xl font-bold">₱{summary.totalNet.toLocaleString()}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500">
                                            <div className="flex items-center">
                                                <div className="bg-red-100 p-3 rounded-full mr-4">
                                                    <i className="fas fa-chart-line text-red-600 text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-gray-500 text-sm">Pending Leave Requests</h3>
                                                    <p className="text-3xl font-bold">{leaveRequests.filter(r => r.status === 'Pending').length}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div className="mb-8">
                                            <h3 className="font-semibold mb-4 text-gray-700">Recent Activities (Process)</h3>
                                            <div className="bg-gray-50 p-4 rounded-lg border">
                                                <ul className="space-y-3">
                                                    <li className="flex items-center py-2 border-b">
                                                        <i className="fas fa-user-plus text-green-500 mr-3"></i>
                                                        <div>
                                                            <p className="font-medium">New employee added</p>
                                                            <p className="text-sm text-gray-600">Shanele Espartero joined as Server</p>
                                                        </div>
                                                    </li>
                                                    <li className="flex items-center py-2 border-b">
                                                        <i className="fas fa-money-check text-amber-500 mr-3"></i>
                                                        <div>
                                                            <p className="font-medium">Payroll processed</p>
                                                            <p className="text-sm text-gray-600">October 2025 payroll completed</p>
                                                        </div>
                                                    </li>
                                                    <li className="flex items-center py-2">
                                                        <i className="fas fa-plane-departure text-red-500 mr-3"></i>
                                                        <div>
                                                            <p className="font-medium">Leave Request Pending</p>
                                                            <p className="text-sm text-gray-600">Maria Ellaine Santos submitted 2-day leave</p>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h3 className="font-semibold mb-4 text-gray-700">Upcoming Schedule (Input: Cutoff Date)</h3>
                                            <div className="bg-amber-50 p-4 rounded-lg border border-amber-200">
                                                <div className="flex items-center mb-3">
                                                    <i className="far fa-calendar-alt text-amber-500 mr-3 text-xl"></i>
                                                    <div>
                                                        <p className="font-medium">Next Payroll Processing</p>
                                                        <p className="text-sm text-gray-600">Cut-off is on the {systemSettings.cutOffDate}th of the month.</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-center">
                                                    <i className="fas fa-bell text-yellow-600 mr-3 text-xl"></i>
                                                    <div>
                                                        <p className="font-medium">Tax Filing Deadline</p>
                                                        <p className="text-sm text-gray-600">December 15, 2025</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {activeTab === 'employees' && (/* ... Employees Tab Content (Omitted for brevity) ...*/
                                <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                                    <h2 className="text-xl font-bold text-amber-800 mb-6">Employee Management (Employee Data Input)</h2>
                                    
                                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                        <div className="lg:col-span-2">
                                            <div className="mb-4 flex justify-between items-center">
                                                <h3 className="font-semibold text-lg">Employee List</h3>
                                                <span className="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                                                    Total: {employees.length} employees
                                                </span>
                                            </div>
                                            
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-left">
                                                    <thead className="bg-amber-100">
                                                        <tr>
                                                            <th className="p-3 font-semibold">ID</th>
                                                            <th className="font-semibold">Name</th>
                                                            <th className="font-semibold">Position</th>
                                                            <th className="font-semibold">Rate/Day</th>
                                                            <th className="font-semibold">Leave Credits</th>
                                                            <th className="font-semibold">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {employees.map(emp => {
                                                            return (
                                                                <tr key={emp.id} className="border-b hover:bg-gray-50 transition-colors">
                                                                    <td className="p-3">{emp.id}</td>
                                                                    <td className="font-medium">{emp.name}</td>
                                                                    <td>
                                                                        <span className={`px-2 py-1 rounded text-xs ${
                                                                            emp.position === 'Manager' ? 'bg-purple-100 text-purple-800' :
                                                                            emp.position === 'Cook' ? 'bg-green-100 text-green-800' :
                                                                            emp.position === 'Cashier' ? 'bg-blue-100 text-blue-800' :
                                                                            'bg-gray-100 text-gray-800'
                                                                        }`}>
                                                                            {emp.position}
                                                                        </span>
                                                                    </td>
                                                                    <td>₱{emp.dailyRate.toLocaleString()}</td>
                                                                    <td className="font-semibold text-center">{emp.leaveCredits}</td>
                                                                    <td>
                                                                        <div className="flex space-x-2">
                                                                            <button 
                                                                                className="text-blue-500 hover:text-blue-700 transition-colors"
                                                                                onClick={() => setSelectedEmployee(emp)}
                                                                                title="View Details"
                                                                            >
                                                                                <i className="fas fa-eye"></i>
                                                                            </button>
                                                                            <button 
                                                                                className="text-red-500 hover:text-red-700 transition-colors"
                                                                                onClick={() => deleteEmployee(emp.id)}
                                                                                title="Delete Employee"
                                                                            >
                                                                                <i className="fas fa-trash"></i>
                                                                            </button>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                            );
                                                        })}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <div className="bg-gray-50 p-4 rounded-lg shadow-sm border">
                                                <h3 className="font-semibold mb-3 text-gray-800">Add New Employee</h3>
                                                <form onSubmit={addEmployee}>
                                                    <div className="mb-3">
                                                        <label className="block text-sm mb-1 font-medium">Full Name</label>
                                                        <input 
                                                            type="text" 
                                                            value={newEmployee.name}
                                                            onChange={(e) => setNewEmployee({...newEmployee, name: e.target.value})}
                                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300 focus:border-amber-500"
                                                            placeholder="Enter full name"
                                                            required
                                                        />
                                                    </div>
                                                    <div className="mb-3">
                                                        <label className="block text-sm mb-1 font-medium">Position</label>
                                                        <select
                                                            value={newEmployee.position}
                                                            onChange={(e) => setNewEmployee({...newEmployee, position: e.target.value})}
                                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300 focus:border-amber-500"
                                                            required
                                                        >
                                                            <option value="">Select Position</option>
                                                            <option value="Manager">Manager</option>
                                                            <option value="Cook">Cook</option>
                                                            <option value="Cashier">Cashier</option>
                                                            <option value="Server">Server</option>
                                                        </select>
                                                    </div>
                                                    <div className="mb-3">
                                                        <label className="block text-sm mb-1 font-medium">Daily Rate (₱)</label>
                                                        <input 
                                                            type="number" 
                                                            value={newEmployee.dailyRate}
                                                            onChange={(e) => setNewEmployee({...newEmployee, dailyRate: e.target.value})}
                                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300 focus:border-amber-500"
                                                            placeholder="e.g. 500"
                                                            required
                                                        />
                                                    </div>
                                                    <div className="mb-3">
                                                        <label className="block text-sm mb-1 font-medium">Days Worked (Initial DTR/Attendance)</label>
                                                        <input 
                                                            type="number" 
                                                            value={newEmployee.daysWorked}
                                                            onChange={(e) => setNewEmployee({...newEmployee, daysWorked: e.target.value})}
                                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300 focus:border-amber-500"
                                                            placeholder="e.g. 13"
                                                        />
                                                    </div>
                                                    <div className="mb-3">
                                                        <label className="block text-sm mb-1 font-medium">Overtime Hours (Initial DTR/Attendance)</label>
                                                        <input 
                                                            type="number" 
                                                            value={newEmployee.overtimeHours}
                                                            onChange={(e) => setNewEmployee({...newEmployee, overtimeHours: e.target.value})}
                                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300 focus:border-amber-500"
                                                            placeholder="e.g. 5"
                                                        />
                                                    </div>
                                                    <div className="mb-4">
                                                        <label className="block text-sm mb-1 font-medium">Email Address</label>
                                                        <input 
                                                            type="email" 
                                                            value={newEmployee.email}
                                                            onChange={(e) => setNewEmployee({...newEmployee, email: e.target.value})}
                                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300 focus:border-amber-500"
                                                            placeholder="e.g. name@example.com"
                                                            required
                                                        />
                                                    </div>
                                                    <button 
                                                        type="submit"
                                                        className="w-full bg-amber-600 text-white py-2 rounded-lg hover:bg-amber-700 transition-colors"
                                                    >
                                                        <i className="fas fa-plus-circle mr-2"></i> Add Employee
                                                    </button>
                                                </form>
                                            </div>
                                            
                                            {selectedEmployee && (
                                                <div className="mt-6 bg-amber-50 p-4 rounded-lg border border-amber-200">
                                                    <h3 className="font-bold text-amber-800 mb-2">{selectedEmployee.name} Details</h3>
                                                    <p className="text-sm">Position: **{selectedEmployee.position}** | Daily Rate: **₱{selectedEmployee.dailyRate.toLocaleString()}**</p>
                                                    <p className="text-sm">Current Days Worked: **{selectedEmployee.daysWorked}** | Current OT Hrs: **{selectedEmployee.overtimeHours}** | Leave Credits: **{selectedEmployee.leaveCredits}**</p>
                                                    <div className="mt-3">
                                                        <button 
                                                            className="text-blue-600 hover:underline text-sm font-medium"
                                                            onClick={() => { setActiveTab('payroll'); setShowComputation(true); }}
                                                        >
                                                            <i className="fas fa-calculator mr-1"></i> View Payslip
                                                        </button>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'dtr' && <DTRTab />}
                            {activeTab === 'leave' && <LeaveTab />}
                            {activeTab === 'payroll' && <PayrollTab />}

                            {activeTab === 'reports' && (/* ... Reports Tab Content (Omitted for brevity) ...*/
                                <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                                    <h2 className="text-xl font-bold text-amber-800 mb-6">System Reports</h2>
                                    
                                    <h3 className="font-semibold text-lg text-gray-800 mb-3">Generate New Report</h3>
                                    <div className="flex space-x-4 mb-8 p-4 bg-gray-50 rounded-lg border">
                                        <button 
                                            className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors"
                                            onClick={() => generateReport("Payroll Summary")}
                                        >
                                            <i className="fas fa-file-pdf mr-2"></i> Generate Payroll Summary
                                        </button>
                                        <button 
                                            className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
                                            onClick={() => generateReport("Employee List")}
                                        >
                                            <i className="fas fa-file-excel mr-2"></i> Generate Employee List
                                        </button>
                                        <button 
                                            className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors"
                                            onClick={() => generateReport("Deductions Report")}
                                        >
                                            <i className="fas fa-file-alt mr-2"></i> Generate Deductions Report
                                        </button>
                                    </div>
                                    
                                    <h3 className="font-semibold text-lg text-gray-800 mb-3">Report History</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="p-3 font-semibold">Report Name</th>
                                                    <th className="font-semibold">Type</th>
                                                    <th className="font-semibold">Date Generated</th>
                                                    <th className="font-semibold">Format</th>
                                                    <th className="font-semibold">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {reports.map(report => (
                                                    <tr key={report.id} className="border-b hover:bg-gray-50 transition-colors">
                                                        <td className="p-3 font-medium">{report.name}</td>
                                                        <td>{report.type}</td>
                                                        <td>{report.date}</td>
                                                        <td>
                                                            <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                                report.format === 'PDF' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'
                                                            }`}>{report.format}</span>
                                                        </td>
                                                        <td>
                                                            <div className="flex space-x-2">
                                                                <button className="text-blue-500 hover:text-blue-700 transition-colors"><i className="fas fa-download"></i></button>
                                                                <button className="text-red-500 hover:text-red-700 transition-colors"><i className="fas fa-trash"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'settings' && (/* ... Settings Tab Content (Omitted for brevity) ...*/
                                <div className="bg-white rounded-lg shadow-md p-6 fade-in">
                                    <h2 className="text-xl font-bold text-amber-800 mb-6">System Settings</h2>   
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="bg-gray-50 p-4 rounded-lg border">
                                            <h3 className="font-semibold text-lg mb-4 text-gray-800">General Payroll Settings</h3>
                                            <div className="mb-4">
                                                <label className="block text-sm font-medium mb-1">Cut-off Day of the Month</label>
                                                <input 
                                                    type="number" 
                                                    value={systemSettings.cutOffDate}
                                                    onChange={(e) => handleSettingsChange('cutOffDate', e.target.value)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                                    min="1"
                                                    max="31"
                                                    required
                                                />
                                                <p className="text-xs text-gray-500 mt-1">Example: 15 for a mid-month cutoff.</p>
                                            </div>
                                            <div className="mb-4">
                                                <label className="block text-sm font-medium mb-1">Overtime Factor (Multiplier)</label>
                                                <input 
                                                    type="number" 
                                                    step="0.01"
                                                    value={systemSettings.overtimeFactor}
                                                    onChange={(e) => handleSettingsChange('overtimeFactor', e.target.value)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                                    min="1.0"
                                                    required
                                                />
                                                <p className="text-xs text-gray-500 mt-1">e.g., 1.25 for 125% of the regular hourly rate.</p>
                                            </div>
                                        </div>

                                        <div className="bg-gray-50 p-4 rounded-lg border">
                                            <h3 className="font-semibold text-lg mb-4 text-gray-800">Deduction Rates (3. Deductions)</h3>
                                            <div className="mb-4">
                                                <label className="block text-sm font-medium mb-1">SSS Contribution Rate (%)</label>
                                                <input 
                                                    type="number" 
                                                    step="0.01"
                                                    value={(systemSettings.sssRate * 100).toFixed(2)}
                                                    onChange={(e) => handleSettingsChange('sssRate', parseFloat(e.target.value) / 100)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                                    required
                                                />
                                                <p className="text-xs text-gray-500 mt-1">Note: Actual SSS is usually based on a contribution table.</p>
                                            </div>
                                            <div className="mb-4">
                                                <label className="block text-sm font-medium mb-1">PhilHealth Rate (%)</label>
                                                <input 
                                                    type="number" 
                                                    step="0.01"
                                                    value={(systemSettings.philhealthRate * 100).toFixed(2)}
                                                    onChange={(e) => handleSettingsChange('philhealthRate', parseFloat(e.target.value) / 100)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                                    required
                                                />
                                            </div>
                                            <div className="mb-4">
                                                <label className="block text-sm font-medium mb-1">Pag-IBIG Monthly Contribution (₱)</label>
                                                <input 
                                                    type="number" 
                                                    value={systemSettings.pagibigRate}
                                                    onChange={(e) => handleSettingsChange('pagibigRate', e.target.value)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                                    required
                                                />
                                            </div>
                                            <div className="mb-4">
                                                <label className="block text-sm font-medium mb-1">Withholding Tax Rate (%)</label>
                                                <input 
                                                    type="number" 
                                                    step="0.01"
                                                    value={(systemSettings.taxRate * 100).toFixed(2)}
                                                    onChange={(e) => handleSettingsChange('taxRate', parseFloat(e.target.value) / 100)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-amber-300"
                                                    required
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="mt-6 flex justify-end">
                                        <button 
                                            className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors"
                                            onClick={() => alert('System settings saved successfully!')}
                                        >
                                            <i className="fas fa-save mr-2"></i> Save Settings
                                        </button>
                                    </div>
                                </div>
                            )}
                        </main>
                    </div>

                    <footer className="mt-8 text-center text-sm text-gray-600 p-4 bg-white border-t">
                        <p className="font-medium">PAYROLL MANAGEMENT SYSTEM FOR TINNAY SNACK AND SILOGAN WITH E-MAIL NOTIFICATION SYSTEM</p>
                        <p className="mt-2">© 2025 Tinnay Snack and Silogan. All rights reserved.</p>
                    </footer>
                </div>
            );
        };

        // --- MAIN APPLICATION WRAPPER (UPDATED to share state) ---
        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [userRole, setUserRole] = useState(null); 
            const [loggedInEmployee, setLoggedInEmployee] = useState(null); 
            const [employees, setEmployees] = useState(initialEmployees); // Shared State
            const [leaveRequests, setLeaveRequests] = useState(initialLeaveRequests); // Shared State
            const [systemSettings, setSystemSettings] = useState(initialSystemSettings); 

            // Modified login function to handle dynamic employee authentication
            const handleLogin = (username, password, role) => {
                if (role === 'administrator' && username === 'admin' && password === 'tinnay2025') {
                    setUserRole('administrator');
                    setIsLoggedIn(true);
                    setLoggedInEmployee(null); 
                    return true;
                }
                
                if (role === 'employee') {
                    // NEW: Employee login logic checks ID (username) and constructed password (emp + ID)
                    const employee = employees.find(
                        // Username must match the Employee ID (converted to string)
                        (emp) => emp.id.toString() === username 
                    );

                    // Expected password is 'emp' followed by the ID
                    const expectedPassword = `emp${username}`; 

                    if (employee && expectedPassword === password) {
                        setUserRole('employee');
                        setIsLoggedIn(true);
                        setLoggedInEmployee(employee); 
                        return true;
                    }
                }
                
                return false;
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setUserRole(null);
                setLoggedInEmployee(null);
            };

            if (!isLoggedIn) {
                // Pass the current employees data to the LoginScreen for demo instructions
                return <LoginScreen onLogin={handleLogin} employees={employees} />; 
            }
            
            if (userRole === 'administrator') {
                return <PayrollApp 
                    onLogout={handleLogout} 
                    employees={employees} 
                    setEmployees={setEmployees}
                    leaveRequests={leaveRequests}
                    setLeaveRequests={setLeaveRequests}
                />;
            } else if (userRole === 'employee' && loggedInEmployee) {
                return <EmployeeDashboard 
                    employee={loggedInEmployee} 
                    onLogout={handleLogout} 
                    settings={systemSettings}
                    employees={employees}
                    leaveRequests={leaveRequests}
                    setLeaveRequests={setLeaveRequests}
                />;
            }
            
            return <LoginScreen onLogin={handleLogin} employees={employees} />;
        };

        // ... (LoginScreen Component remains the same, but accepts employees for text) ...
        const LoginScreen = ({ onLogin, employees }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [role, setRole] = useState('administrator'); // NEW: Role state
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                if (onLogin(username, password, role)) {
                    // Login successful
                } else {
                    setError(`Invalid ${role} credentials. Please try again.`);
                    setPassword('');
                }
            };
            
            // Generate dynamic demo credentials text
            const employeeDemoText = employees.slice(0, 3).map(emp => 
                `${emp.name} (Username: ${emp.id} / Password: emp${emp.id})`
            ).join(' | ') + ` ... and 2 others.`;


            return (
                <div className="login-background flex items-center justify-center min-h-screen"> 
                    <div className="w-full max-w-md p-8 m-4 bg-white rounded-lg shadow-xl fade-in">
                        <div className="text-center mb-6">
                            <img 
                                src=https://i.postimg.cc/63kPCnYQ/logo.png
                                alt="Tinnay Snack and Silogan Logo"
                                className="w-20 h-20 mb-3 object-contain mx-auto" 
                            />
                            <h2 className="text-3xl font-bold text-gray-800">System Login</h2>
                            <p className="text-gray-500">Tinnay Snack and Silogan Payroll</p>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="role">
                                    Login As
                                </label>
                                <select
                                    className="shadow appearance-none border rounded w-full py-3 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-amber-500"
                                    id="role"
                                    value={role}
                                    onChange={(e) => setRole(e.target.value)}
                                    required
                                >
                                    <option value="administrator">Administrator</option>
                                    <option value="employee">Employee</option>
                                </select>
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="username">
                                    Username
                                </label>
                                <input
                                    className="shadow appearance-none border rounded w-full py-3 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-amber-500"
                                    id="username"
                                    type="text"
                                    placeholder={role === 'administrator' ? 'admin' : 'Employee ID (1-5)'}
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-6">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="password">
                                    Password
                                </label>
                                <input
                                    className="shadow appearance-none border rounded w-full py-3 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:ring-2 focus:ring-amber-500"
                                    id="password"
                                    type="password"
                                    placeholder={role === 'administrator' ? 'password' : 'emp + Employee ID (e.g., emp1)'}
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            {error && (
                                <p className="text-red-500 text-xs italic mb-4">{error}</p>
                            )}
                            <div className="flex items-center justify-between">
                                <button
                                    className="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-4 rounded focus:outline-none focus:shadow-outline transition-colors"
                                    type="submit"
                                >
                                    <i className="fas fa-sign-in-alt mr-2"></i> Sign In as {role.charAt(0).toUpperCase() + role.slice(1)}
                                </button>
                            </div>
                            {role === 'employee' && (
                                <div className="text-sm text-center text-gray-600 mt-2 p-2 bg-gray-100 rounded">
                                </div>
                            )}
                        </form>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

<div class="footer-fixed">Payroll Management System — Tinnay Snack &amp; Silogan © 2025</div>
</body>
</html>
